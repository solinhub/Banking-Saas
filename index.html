<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Financial Projections - Payment Reconciliation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        select, input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        select:focus, input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .bank-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .bank-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .bank-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .results {
            margin-top: 30px;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            padding: 25px;
            border-radius: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .card h3 {
            margin-bottom: 10px;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .card .amount {
            font-size: 24px;
            font-weight: bold;
        }
        
        .detailed-table {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .toggle-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .toggle-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .hidden {
            display: none;
        }
        
        .currency-toggle {
            text-align: center;
            margin: 20px 0;
        }
        
        .currency-btn {
            padding: 10px 20px;
            margin: 0 5px;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .currency-btn.active {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SaaS Payment Reconciliation</h1>
            <h2>Financial Projections Model</h2>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="currentYear">Current Year:</label>
                <select id="currentYear">
                    <option value="2025">2025 (Year 1)</option>
                    <option value="2026">2026 (Year 2)</option>
                    <option value="2027">2027 (Year 3)</option>
                </select>
            </div>
            <div class="control-group">
                <label for="currentMonth">Current Month:</label>
                <select id="currentMonth">
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
            </div>
            <div class="control-group">
                <label for="exchangeRate">Exchange Rate (₦/$):</label>
                <input type="number" id="exchangeRate" value="1600" step="0.01">
            </div>
            <div class="control-group">
                <label for="annualGrowth">Annual Volume Growth (%):</label>
                <input type="number" id="annualGrowth" value="10" step="0.1">
            </div>
        </div>
        
        <div id="banksContainer">
            <!-- Banks will be dynamically generated -->
        </div>
        
        <div class="currency-toggle">
            <button class="currency-btn active" onclick="toggleCurrency('naira')">Nigerian Naira (₦)</button>
            <button class="currency-btn" onclick="toggleCurrency('usd')">US Dollars ($)</button>
        </div>
        
        <div class="results">
            <div class="summary-cards" id="summaryCards">
                <!-- Summary cards will be generated here -->
            </div>
            
            <div class="detailed-table">
                <table id="resultsTable">
                    <!-- Table will be generated here -->
                </table>
            </div>
        </div>
    </div>

    <script>
        let currentCurrency = 'naira';
        let bankData = {};

        // Initialize with default banks
        for (let i = 1; i <= 5; i++) {
            bankData[`bank${i}`] = {
                name: `Bank ${i}`,
                active: i === 1, // Only Bank 1 active by default
                dailyTransactions: i === 1 ? 100000 : 50000,
                transactionRate: 10,
                processes: 1,
                startYear: i === 1 ? 2025 : 2026,
                implementedProcesses: new Set()
            };
        }

        function initializePage() {
            generateBankControls();
            calculateProjections();
        }

        function generateBankControls() {
            const container = document.getElementById('banksContainer');
            container.innerHTML = '';

            for (let i = 1; i <= 5; i++) {
                const bankDiv = document.createElement('div');
                bankDiv.className = 'bank-section';

                bankDiv.innerHTML = `
                    <div class="bank-header">
                        <h3>Bank ${i} Settings</h3>
                        <button class="toggle-button" onclick="toggleBank('bank${i}')">
                            ${bankData[`bank${i}`].active ? 'Deactivate' : 'Activate'}
                        </button>
                    </div>
                    <div class="bank-controls ${!bankData[`bank${i}`].active ? 'hidden' : ''}" id="controls-bank${i}">
                        <div class="control-group">
                            <label>Bank Name:</label>
                            <input type="text" value="${bankData[`bank${i}`].name}" 
                                   onchange="updateBankData('bank${i}', 'name', this.value)">
                        </div>
                        <div class="control-group">
                            <label>Daily Transactions:</label>
                            <input type="number" value="${bankData[`bank${i}`].dailyTransactions}" 
                                   onchange="updateBankData('bank${i}', 'dailyTransactions', parseInt(this.value))">
                        </div>
                        <div class="control-group">
                            <label>Rate per Transaction (₦):</label>
                            <select onchange="updateBankData('bank${i}', 'transactionRate', parseInt(this.value))">
                                ${generateRateOptions(bankData[`bank${i}`].transactionRate)}
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Active Processes:</label>
                            <select onchange="updateBankData('bank${i}', 'processes', parseInt(this.value))">
                                ${generateProcessOptions(bankData[`bank${i}`].processes)}
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Start Year:</label>
                            <select onchange="updateBankData('bank${i}', 'startYear', parseInt(this.value))">
                                <option value="2025" ${bankData[`bank${i}`].startYear === 2025 ? 'selected' : ''}>2025</option>
                                <option value="2026" ${bankData[`bank${i}`].startYear === 2026 ? 'selected' : ''}>2026</option>
                                <option value="2027" ${bankData[`bank${i}`].startYear === 2027 ? 'selected' : ''}>2027</option>
                            </select>
                        </div>
                    </div>
                `;

                container.appendChild(bankDiv);
            }
        }

        function generateRateOptions(selected) {
            let options = '';
            for (let rate = 2; rate <= 30; rate++) {
                options += `<option value="${rate}" ${rate === selected ? 'selected' : ''}>₦${rate}</option>`;
            }
            return options;
        }

        function generateProcessOptions(selected) {
            let options = '';
            for (let proc = 1; proc <= 15; proc++) {
                options += `<option value="${proc}" ${proc === selected ? 'selected' : ''}>${proc} Process${proc > 1 ? 'es' : ''}</option>`;
            }
            return options;
        }

        function toggleBank(bankId) {
            bankData[bankId].active = !bankData[bankId].active;
            generateBankControls();
            calculateProjections();
        }

        function updateBankData(bankId, field, value) {
            bankData[bankId][field] = value;
            calculateProjections();
        }

        function calculateProjections() {
            const currentYear = parseInt(document.getElementById('currentYear').value);
            const currentMonth = parseInt(document.getElementById('currentMonth').value);
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value);
            const annualGrowth = parseFloat(document.getElementById('annualGrowth').value) / 100;

            let totalRevenue = 0;
            let totalTransactionRevenue = 0;
            let totalImplementationRevenue = 0;
            let totalCosts = 0;
            let pinnShare = 0;
            let cashlinkShare = 0;

            const results = [];

            // Calculate for each active bank
            Object.keys(bankData).forEach(bankId => {
                const bank = bankData[bankId];
                if (!bank.active || currentYear < bank.startYear) return;

                // Calculate growth factor
                const yearsSinceStart = currentYear - bank.startYear;
                const growthFactor = Math.pow(1 + annualGrowth, yearsSinceStart);

                // Monthly transactions
                const monthlyTransactions = bank.dailyTransactions * 30 * growthFactor;
                const transactionRevenue = monthlyTransactions * bank.transactionRate * bank.processes;

                // Implementation fees - $20K per process (check if this is first time implementing these processes)
                let implementationRevenue = 0;

                // Initialize implementedProcesses if not exists
                if (!bank.implementedProcesses) {
                    bank.implementedProcesses = new Set();
                }

                // For first month/year of operation or when processes increase
                const processKey = `${bankId}-processes-${bank.processes}`;
                const isFirstPeriod = (currentYear === bank.startYear && currentMonth === 1);
                const hasNewProcesses = !bank.implementedProcesses.has(processKey);

                if (isFirstPeriod || hasNewProcesses) {
                    // Calculate how many NEW processes need implementation fees
                    let newProcessCount = bank.processes;

                    // If not first period, only charge for additional processes
                    if (!isFirstPeriod) {
                        const previousProcesses = Array.from(bank.implementedProcesses)
                            .filter(key => key.startsWith(`${bankId}-processes-`))
                            .map(key => parseInt(key.split('-')[2]))
                            .sort((a, b) => b - a)[0] || 0;

                        newProcessCount = Math.max(0, bank.processes - previousProcesses);
                    }

                    if (newProcessCount > 0) {
                        implementationRevenue = newProcessCount * 20000 * exchangeRate; // $20k per process
                        bank.implementedProcesses.add(processKey);
                    }
                }

                totalTransactionRevenue += transactionRevenue;
                totalImplementationRevenue += implementationRevenue;

                results.push({
                    bank: bank.name,
                    monthlyTransactions,
                    transactionRevenue,
                    implementationRevenue,
                    processes: bank.processes
                });
            });

            totalRevenue = totalTransactionRevenue + totalImplementationRevenue;

            // Costs (monthly)
            const serverCost = 653694.29; // From the quote
            const staffCost = 2000 * exchangeRate; // $2k converted to Naira
            totalCosts = serverCost + staffCost;

            // Revenue splits
            const transactionPinnShare = totalTransactionRevenue * 0.6;
            const transactionCashlinkShare = totalTransactionRevenue * 0.4;
            const implementationPinnShare = totalImplementationRevenue * 0.3;
            const implementationCashlinkShare = totalImplementationRevenue * 0.7;

            pinnShare = transactionPinnShare + implementationPinnShare;
            cashlinkShare = transactionCashlinkShare + implementationCashlinkShare;

            const netProfit = pinnShare - totalCosts;

            updateSummaryCards({
                totalRevenue,
                pinnShare,
                cashlinkShare,
                totalCosts,
                netProfit,
                exchangeRate
            });

            updateResultsTable(results, {
                totalTransactionRevenue,
                totalImplementationRevenue,
                totalRevenue,
                transactionPinnShare,
                transactionCashlinkShare,
                implementationPinnShare,
                implementationCashlinkShare,
                pinnShare,
                cashlinkShare,
                totalCosts,
                netProfit,
                exchangeRate
            });
        }

        function updateSummaryCards(data) {
            const container = document.getElementById('summaryCards');
            const format = currentCurrency === 'naira' ? formatNaira : (val) => formatUSD(val, data.exchangeRate);

            container.innerHTML = `
                <div class="card">
                    <h3>Total Revenue</h3>
                    <div class="amount">${format(data.totalRevenue)}</div>
                </div>
                <div class="card">
                    <h3>Pinn Business Share</h3>
                    <div class="amount">${format(data.pinnShare)}</div>
                </div>
                <div class="card">
                    <h3>Net Profit (Pinn)</h3>
                    <div class="amount">${format(data.netProfit)}</div>
                </div>
                <div class="card">
                    <h3>Total Costs</h3>
                    <div class="amount">${format(data.totalCosts)}</div>
                </div>
            `;
        }

        function updateResultsTable(bankResults, totals) {
            const table = document.getElementById('resultsTable');
            const format = currentCurrency === 'naira' ? formatNaira : (val) => formatUSD(val, totals.exchangeRate);

            let tableHTML = `
                <thead>
                    <tr>
                        <th>Bank</th>
                        <th>Monthly Transactions</th>
                        <th>Processes</th>
                        <th>Transaction Revenue</th>
                        <th>Implementation Revenue</th>
                        <th>Total Revenue</th>
                    </tr>
                </thead>
                <tbody>
            `;

            bankResults.forEach(bank => {
                tableHTML += `
                    <tr>
                        <td style="text-align: left;">${bank.bank}</td>
                        <td>${bank.monthlyTransactions.toLocaleString()}</td>
                        <td>${bank.processes}</td>
                        <td>${format(bank.transactionRevenue)}</td>
                        <td>${format(bank.implementationRevenue)}</td>
                        <td>${format(bank.transactionRevenue + bank.implementationRevenue)}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    <tr style="border-top: 2px solid #667eea; font-weight: bold; background: rgba(102, 126, 234, 0.1);">
                        <td style="text-align: left;">TOTALS</td>
                        <td>-</td>
                        <td>-</td>
                        <td>${format(totals.totalTransactionRevenue)}</td>
                        <td>${format(totals.totalImplementationRevenue)}</td>
                        <td>${format(totals.totalRevenue)}</td>
                    </tr>
                </tbody>
            `;

            // Revenue split section
            tableHTML += `
                <thead>
                    <tr style="background: #764ba2;">
                        <th colspan="6">Revenue Distribution</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="text-align: left;">Pinn Business (60% Transactions)</td>
                        <td colspan="5">${format(totals.transactionPinnShare)}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">Pinn Business (30% Implementation)</td>
                        <td colspan="5">${format(totals.implementationPinnShare)}</td>
                    </tr>
                    <tr style="font-weight: bold;">
                        <td style="text-align: left;">Total Pinn Business Share</td>
                        <td colspan="5">${format(totals.pinnShare)}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">Cashlink Global Share</td>
                        <td colspan="5">${format(totals.cashlinkShare)}</td>
                    </tr>
                    <tr style="border-top: 2px solid #667eea;">
                        <td style="text-align: left;">Total Costs</td>
                        <td colspan="5">${format(totals.totalCosts)}</td>
                    </tr>
                    <tr style="font-weight: bold; background: rgba(102, 126, 234, 0.1);">
                        <td style="text-align: left;">Net Profit (Pinn)</td>
                        <td colspan="5">${format(totals.netProfit)}</td>
                    </tr>
                </tbody>
            `;
            
            table.innerHTML = tableHTML;
        }

        function formatNaira(amount) {
            return '₦' + Math.round(amount).toLocaleString();
        }

        function formatUSD(amount, exchangeRate) {
            return '$' + Math.round(amount / exchangeRate).toLocaleString();
        }

        function toggleCurrency(currency) {
            currentCurrency = currency;

            // Update button states
            document.querySelectorAll('.currency-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ensure correct `event` target
            event.target.classList.add('active');

            calculateProjections();
        }

        // Event listeners
        document.getElementById('currentYear').addEventListener('change', calculateProjections);
        document.getElementById('currentMonth').addEventListener('change', calculateProjections);
        document.getElementById('exchangeRate').addEventListener('change', calculateProjections);
        document.getElementById('annualGrowth').addEventListener('change', calculateProjections);

        // Initialize
        initializePage();
    </script>
</body>
</html>
